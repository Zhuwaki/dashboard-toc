import plotly.express as px
import geopandas as gpd
import shapely.wkt
import shapely.geometry
import numpy as np
import pandas


#Read trip data
df = pandas.read_csv('15547_Trips_20201230.csv')

#get only trips with more than 1 stop
df2 = df[df['Number Of Stops']>1]

#rename column
df = df2.rename(columns={'Geometry (WKT)':'geometry'})

#prepare for conversion to geodataframe
geometry = df['geometry'].map(shapely.wkt.loads)
df = df.drop('geometry', axis=1)

#convert to geodataframe
gdf = gpd.GeoDataFrame(df, crs="EPSG:4326", geometry=geometry)


#prepare plotting on MapBox

lats = []
lons = []
names = []

for feature, name in zip(gdf.geometry, gdf.Mapper):
    if isinstance(feature, shapely.geometry.linestring.LineString):
        linestrings = [feature]
    elif isinstance(feature, shapely.geometry.multilinestring.MultiLineString):
        linestrings = feature.geoms
    else:
        continue
    for linestring in linestrings:
        x, y = linestring.xy
        lats = np.append(lats, y)
        lons = np.append(lons, x)
        names = np.append(names, [name]*len(y))
        lats = np.append(lats, None)
        lons = np.append(lons, None)
        names = np.append(names, None)
        print(linestring)
        
        

# Plot figure using plot px

fig = px.line_mapbox(lat=lats, lon=lons, hover_name=names,
                     mapbox_style="stamen-terrain", zoom=10.7)
fig.show()